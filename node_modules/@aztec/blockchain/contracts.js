"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Contracts = void 0;
const providers_1 = require("@ethersproject/providers");
const address_1 = require("@aztec/barretenberg/address");
const tx_hash_1 = require("@aztec/barretenberg/tx_hash");
const ethers_1 = require("ethers");
const IDefiBridge_json_1 = require("./artifacts/contracts/interfaces/IDefiBridge.sol/IDefiBridge.json");
const IFeeDistributor_json_1 = require("./artifacts/contracts/interfaces/IFeeDistributor.sol/IFeeDistributor.json");
const asset_1 = require("./asset");
const price_feed_1 = require("./price_feed");
const rollup_processor_1 = require("./rollup_processor");
const signer_1 = require("./signer");
const bridge_id_1 = require("@aztec/barretenberg/bridge_id");
class Contracts {
    constructor(rollupContractAddress, priceFeedContractAddresses, ethereumProvider, confirmations) {
        this.rollupContractAddress = rollupContractAddress;
        this.priceFeedContractAddresses = priceFeedContractAddresses;
        this.confirmations = confirmations;
        this.provider = new providers_1.Web3Provider(ethereumProvider);
        this.signer = new signer_1.Web3Signer(this.provider);
        this.rollupProcessor = new rollup_processor_1.RollupProcessor(rollupContractAddress, this.provider);
    }
    async init() {
        this.feeDistributorContractAddress = await this.rollupProcessor.feeDistributor();
        this.feeDistributorContract = new ethers_1.Contract(this.feeDistributorContractAddress.toString(), IFeeDistributor_json_1.abi, this.provider);
        const assetAddresses = await this.rollupProcessor.getSupportedAssets();
        const tokenAssets = await Promise.all(assetAddresses.map(async (addr, i) => asset_1.TokenAsset.fromAddress(addr, this.provider, await this.rollupProcessor.getAssetPermitSupport(i + 1), this.confirmations)));
        this.assets = [new asset_1.EthAsset(this.provider), ...tokenAssets];
        const [gasPriceFeedAddress, ...tokenPriceFeedAddresses] = this.priceFeedContractAddresses;
        if (gasPriceFeedAddress) {
            this.gasPriceFeed = new price_feed_1.GasPriceFeed(gasPriceFeedAddress, this.provider);
            this.priceFeeds = [new price_feed_1.EthPriceFeed(), ...tokenPriceFeedAddresses.map(a => new price_feed_1.TokenPriceFeed(a, this.provider))];
        }
    }
    async setSupportedAsset(assetAddress, supportsPermit, signingAddress) {
        const signer = signingAddress ? this.provider.getSigner(signingAddress.toString()) : this.provider.getSigner(0);
        const tx = await this.rollupProcessor.setSupportedAsset(assetAddress, supportsPermit, signer);
        const tokenAsset = await asset_1.TokenAsset.fromAddress(assetAddress, this.provider, supportsPermit);
        this.assets.push(tokenAsset);
        return tx;
    }
    async getAssetValues(promise) {
        const padding = Array(this.assets.length).fill(BigInt(0));
        return [...(await promise), ...padding].slice(0, padding.length);
    }
    async getPerRollupState() {
        const nextRollupId = await this.rollupProcessor.nextRollupId();
        const dataSize = await this.rollupProcessor.dataSize();
        const dataRoot = await this.rollupProcessor.dataRoot();
        const nullRoot = await this.rollupProcessor.nullRoot();
        const rootRoot = await this.rollupProcessor.rootRoot();
        const defiRoot = await this.rollupProcessor.defiRoot();
        const defiInteractionHash = await this.rollupProcessor.defiInteractionHash();
        const totalDeposited = await this.getAssetValues(this.rollupProcessor.totalDeposited());
        const totalWithdrawn = await this.getAssetValues(this.rollupProcessor.totalWithdrawn());
        const totalFees = await this.getAssetValues(this.rollupProcessor.totalFees());
        return {
            nextRollupId,
            dataRoot,
            nullRoot,
            rootRoot,
            defiRoot,
            dataSize,
            defiInteractionHash,
            totalDeposited,
            totalWithdrawn,
            totalFees,
        };
    }
    async getPerBlockState() {
        const { escapeOpen, blocksRemaining } = await this.rollupProcessor.getEscapeHatchStatus();
        const totalPendingDeposit = await this.getAssetValues(this.rollupProcessor.totalPendingDeposit());
        const feeDistributorBalance = [];
        for (let i = 0; i < this.assets.length; ++i) {
            feeDistributorBalance[i] = BigInt(await this.feeDistributorContract.txFeeBalance(i));
        }
        return {
            escapeOpen,
            numEscapeBlocksRemaining: blocksRemaining,
            totalPendingDeposit,
            feeDistributorBalance,
        };
    }
    getRollupContractAddress() {
        return this.rollupContractAddress;
    }
    getFeeDistributorContractAddress() {
        return this.feeDistributorContractAddress;
    }
    async createEscapeHatchProofTx(proofData, viewingKeys, signatures, signingAddress) {
        return this.rollupProcessor.createEscapeHatchProofTx(proofData, viewingKeys, signatures, signingAddress);
    }
    async createRollupProofTx(proofData, signatures, viewingKeys, providerSignature, providerAddress, feeReceiver, feeLimit) {
        return this.rollupProcessor.createRollupProofTx(proofData, signatures, viewingKeys, providerSignature, providerAddress, feeReceiver, feeLimit);
    }
    async sendTx(data, options = {}) {
        const { signingAddress, gasLimit } = options;
        const signer = signingAddress ? this.provider.getSigner(signingAddress.toString()) : this.provider.getSigner(0);
        const from = await signer.getAddress();
        const gasPrice = options.gasPrice || (await this.getGasPrice());
        const txRequest = {
            to: this.rollupContractAddress.toString(),
            from,
            gasLimit,
            gasPrice: `0x${gasPrice.toString(16)}`,
            data,
        };
        const txResponse = await signer.sendTransaction(txRequest);
        return tx_hash_1.TxHash.fromString(txResponse.hash);
    }
    async estimateGas(data) {
        const signer = this.provider.getSigner(0);
        const from = await signer.getAddress();
        const txRequest = {
            to: this.rollupContractAddress.toString(),
            from,
            data,
        };
        const estimate = await this.provider.estimateGas(txRequest);
        return estimate.toNumber();
    }
    async getRollupBlocksFrom(rollupId, minConfirmations = this.confirmations) {
        return this.rollupProcessor.getRollupBlocksFrom(rollupId, minConfirmations);
    }
    async getUserPendingDeposit(assetId, account) {
        return this.rollupProcessor.getUserPendingDeposit(assetId, account);
    }
    async getTransactionReceipt(txHash) {
        return this.provider.getTransactionReceipt(txHash.toString());
    }
    async getNetwork() {
        return this.provider.getNetwork();
    }
    async getBlockNumber() {
        return this.provider.getBlockNumber();
    }
    async signMessage(message, address) {
        return this.signer.signMessage(message, address);
    }
    async signTypedData(data, address) {
        return this.signer.signTypedData(data, address);
    }
    getAssets() {
        return this.assets;
    }
    getAsset(assetId) {
        return this.assets[assetId];
    }
    async getAssetPrice(assetId) {
        return this.priceFeeds[assetId].price();
    }
    getPriceFeed(assetId) {
        return this.priceFeeds[assetId];
    }
    getGasPriceFeed() {
        return this.gasPriceFeed;
    }
    async getBridgeId(address) {
        let info;
        try {
            const contract = new ethers_1.Contract(address.toString(), IDefiBridge_json_1.abi, this.provider);
            info = await contract.getInfo();
        }
        catch (e) {
            throw new Error(`Unknown bridge contract: ${address}.`);
        }
        const wethAddress = await this.rollupProcessor.weth();
        const assetAddresses = [
            wethAddress,
            ...this.getAssets()
                .slice(1)
                .map(a => a.getStaticInfo().address),
        ];
        const getAssetIdOrThrow = (assetAddress) => {
            const id = assetAddresses.findIndex(a => a.equals(address_1.EthAddress.fromString(assetAddress)));
            if (id < 0) {
                throw new Error(`Unknown asset address: ${assetAddress}.`);
            }
            return id;
        };
        const inputAssetId = getAssetIdOrThrow(info.inputAsset);
        const outputAssetIdA = getAssetIdOrThrow(info.outputAssetA);
        const outputAssetIdB = info.numOutputAssets > 1 ? getAssetIdOrThrow(info.outputAssetB) : 0;
        return new bridge_id_1.BridgeId(address, info.numOutputAssets, inputAssetId, outputAssetIdA, outputAssetIdB);
    }
    async getUserProofApprovalStatus(address, proofHash) {
        return this.rollupProcessor.getUserProofApprovalStatus(address, proofHash);
    }
    async isContract(address) {
        return (await this.provider.getCode(address.toString())) !== '0x';
    }
    async getGasPrice() {
        return BigInt((await this.provider.getGasPrice()).toString());
    }
}
exports.Contracts = Contracts;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJhY3RzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbnRyYWN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx3REFBd0Q7QUFDeEQseURBQXlEO0FBR3pELHlEQUFxRDtBQUNyRCxtQ0FBa0M7QUFDbEMsd0dBQXlHO0FBQ3pHLG9IQUFxSDtBQUNySCxtQ0FBK0M7QUFFL0MsNkNBQTBFO0FBQzFFLHlEQUFxRDtBQUNyRCxxQ0FBc0M7QUFDdEMsNkRBQXlEO0FBRXpELE1BQWEsU0FBUztJQVVwQixZQUNVLHFCQUFpQyxFQUNqQywwQkFBd0MsRUFDaEQsZ0JBQWtDLEVBQzFCLGFBQXFCO1FBSHJCLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBWTtRQUNqQywrQkFBMEIsR0FBMUIsMEJBQTBCLENBQWM7UUFFeEMsa0JBQWEsR0FBYixhQUFhLENBQVE7UUFFN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLHdCQUFZLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksbUJBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGtDQUFlLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ25GLENBQUM7SUFFTSxLQUFLLENBQUMsSUFBSTtRQUNmLElBQUksQ0FBQyw2QkFBNkIsR0FBRyxNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDakYsSUFBSSxDQUFDLHNCQUFzQixHQUFHLElBQUksaUJBQVEsQ0FDeEMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLFFBQVEsRUFBRSxFQUM3QywwQkFBaUIsRUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FDZCxDQUFDO1FBRUYsTUFBTSxjQUFjLEdBQUcsTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLGtCQUFrQixFQUFFLENBQUM7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