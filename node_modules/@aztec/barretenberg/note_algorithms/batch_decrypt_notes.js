"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.batchDecryptNotes = void 0;
const address_1 = require("../address");
const viewing_key_1 = require("../viewing_key");
const derive_note_secret_1 = require("./derive_note_secret");
exports.batchDecryptNotes = async (viewingKeys, privateKey, noteAlgorithms, grumpkin) => {
    const decryptedNoteLength = 41;
    const dataBuf = await noteAlgorithms.batchDecryptNotes(viewingKeys, privateKey);
    const notes = [];
    for (let i = 0, startIndex = 0; startIndex < dataBuf.length; ++i, startIndex += decryptedNoteLength) {
        const noteBuf = dataBuf.slice(startIndex, startIndex + decryptedNoteLength);
        if (noteBuf.length > 0 && noteBuf[0]) {
            const ephPubKey = new address_1.GrumpkinAddress(viewingKeys.slice((i + 1) * viewing_key_1.ViewingKey.SIZE - 64, (i + 1) * viewing_key_1.ViewingKey.SIZE));
            const noteSecret = derive_note_secret_1.deriveNoteSecret(ephPubKey, privateKey, grumpkin);
            notes[i] = { noteBuf: noteBuf.slice(1), ephPubKey, noteSecret };
        }
    }
    return notes;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmF0Y2hfZGVjcnlwdF9ub3Rlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ub3RlX2FsZ29yaXRobXMvYmF0Y2hfZGVjcnlwdF9ub3Rlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSx3Q0FBNkM7QUFFN0MsZ0RBQTRDO0FBQzVDLDZEQUF3RDtBQUczQyxRQUFBLGlCQUFpQixHQUFHLEtBQUssRUFDcEMsV0FBbUIsRUFDbkIsVUFBa0IsRUFDbEIsY0FBOEIsRUFDOUIsUUFBa0IsRUFDbEIsRUFBRTtJQUNGLE1BQU0sbUJBQW1CLEdBQUcsRUFBRSxDQUFDO0lBQy9CLE1BQU0sT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNoRixNQUFNLEtBQUssR0FBa0MsRUFBRSxDQUFDO0lBQ2hELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLFVBQVUsR0FBRyxDQUFDLEVBQUUsVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUUsVUFBVSxJQUFJLG1CQUFtQixFQUFFO1FBQ25HLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQyxDQUFDO1FBQzVFLElBQUksT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ3BDLE1BQU0sU0FBUyxHQUFHLElBQUkseUJBQWUsQ0FDbkMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyx3QkFBVSxDQUFDLElBQUksR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsd0JBQVUsQ0FBQyxJQUFJLENBQUMsQ0FDN0UsQ0FBQztZQUNGLE1BQU0sVUFBVSxHQUFHLHFDQUFnQixDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDckUsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxDQUFDO1NBQ2pFO0tBQ0Y7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMsQ0FBQyJ9