"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EthereumSdk = exports.createEthSdk = void 0;
const tslib_1 = require("tslib");
const rollup_provider_1 = require("@aztec/barretenberg/rollup_provider");
const service_1 = require("@aztec/barretenberg/service");
const blockchain_1 = require("@aztec/blockchain");
const providers_1 = require("@ethersproject/providers");
const debug_1 = tslib_1.__importDefault(require("debug"));
const detect_node_1 = tslib_1.__importDefault(require("detect-node"));
const events_1 = require("events");
const typeorm_1 = require("typeorm");
const create_sdk_1 = require("../core_sdk/create_sdk");
const sdk_1 = require("../sdk");
const wallet_sdk_1 = require("../wallet_sdk");
const database_1 = require("./database");
const ethereum_sdk_user_1 = require("./ethereum_sdk_user");
tslib_1.__exportStar(require("./ethereum_sdk_user"), exports);
tslib_1.__exportStar(require("./ethereum_sdk_user_asset"), exports);
const debug = debug_1.default('bb:ethereum_sdk');
async function getDb(dbPath = 'data') {
    if (detect_node_1.default) {
        const config = database_1.getOrmConfig(dbPath);
        const connection = await typeorm_1.createConnection(config);
        return new database_1.SQLDatabase(connection);
    }
    else {
        return new database_1.DexieDatabase();
    }
}
async function createEthSdk(ethereumProvider, serverUrl, sdkOptions = {}) {
    var _a;
    const { assets, rollupContractAddress, chainId } = await service_1.getBlockchainStatus(serverUrl);
    const core = await create_sdk_1.createSdk(serverUrl, sdkOptions);
    const db = await getDb(sdkOptions.dbPath);
    await db.init();
    // Set erase flag if requested or contract changed.
    if (sdkOptions.clearDb || !((_a = (await core.getRollupContractAddress())) === null || _a === void 0 ? void 0 : _a.equals(rollupContractAddress))) {
        debug('erasing database');
        await db.clear();
        await core.eraseDb();
    }
    const provider = new providers_1.Web3Provider(ethereumProvider);
    const { chainId: providerChainId } = await provider.getNetwork();
    if (chainId !== providerChainId) {
        throw new Error(`Provider chainId ${providerChainId} does not match rollup provider chainId ${chainId}.`);
    }
    const blockchain = new blockchain_1.ClientEthereumBlockchain(rollupContractAddress, assets, ethereumProvider);
    const ethSigner = new blockchain_1.Web3Signer(provider);
    const walletSdk = new wallet_sdk_1.WalletSdk(core, blockchain, ethSigner, sdkOptions);
    return new EthereumSdk(walletSdk, db, ethSigner);
}
exports.createEthSdk = createEthSdk;
class EthereumSdk extends events_1.EventEmitter {
    constructor(walletSdk, db, ethSigner) {
        super();
        this.walletSdk = walletSdk;
        this.db = db;
        this.ethSigner = ethSigner;
    }
    async init() {
        // Forward all walletSdk events.
        for (const e in sdk_1.SdkEvent) {
            const event = sdk_1.SdkEvent[e];
            this.walletSdk.on(event, (...args) => this.emit(event, ...args));
        }
        await this.walletSdk.init();
        this.emit(sdk_1.SdkEvent.LOG, 'Synching data tree state...');
        const start = new Date().getTime();
        await this.walletSdk.awaitSynchronised();
        const time = (new Date().getTime() - start) / 1000;
        this.emit(sdk_1.SdkEvent.LOG, `Sync took ${time.toFixed(0)} seconds.`);
    }
    async destroy() {
        var _a, _b;
        await ((_a = this.walletSdk) === null || _a === void 0 ? void 0 : _a.destroy());
        await ((_b = this.db) === null || _b === void 0 ? void 0 : _b.close());
        this.removeAllListeners();
    }
    isUserSynching(userId) {
        return this.walletSdk.isUserSynching(userId);
    }
    async awaitUserSynchronised(accountId) {
        return this.walletSdk.awaitUserSynchronised(accountId);
    }
    async awaitSynchronised() {
        return this.walletSdk.awaitSynchronised();
    }
    async awaitSettlement(txHash, timeout) {
        return this.walletSdk.awaitSettlement(txHash, timeout);
    }
    getLocalStatus() {
        return this.walletSdk.getLocalStatus();
    }
    async getRemoteStatus() {
        return this.walletSdk.getRemoteStatus();
    }
    async getFee(assetId, txType, speed = rollup_provider_1.SettlementTime.SLOW) {
        return this.walletSdk.getFee(assetId, txType, speed);
    }
    getUserPendingDeposit(assetId, account) {
        return this.walletSdk.getUserPendingDeposit(assetId, account);
    }
    async getPublicKeyFromAddress(address) {
        const account = await this.db.getAccount(address);
        return account === null || account === void 0 ? void 0 : account.accountPublicKey;
    }
    async isAliasAvailable(alias) {
        return this.walletSdk.isAliasAvailable(alias);
    }
    async approve(assetId, value, ethAddress) {
        return this.walletSdk.approve(assetId, value, ethAddress);
    }
    async mint(assetId, value, ethAddress) {
        return this.walletSdk.mint(assetId, value, ethAddress);
    }
    async depositFundsToContract(assetId, from, value, permitArgs) {
        return this.walletSdk.depositFundsToContract(assetId, from, value, permitArgs);
    }
    async createDepositProof(assetId, from, to, value, fee) {
        const userData = this.walletSdk.getUserData(to);
        const aztecSigner = this.walletSdk.createSchnorrSigner(userData.privateKey);
        return this.walletSdk.createDepositProof(assetId, from, to, value, fee, aztecSigner);
    }
    async createWithdrawProof(assetId, from, to, value, fee) {
        const userData = this.walletSdk.getUserData(from);
        const aztecSigner = this.walletSdk.createSchnorrSigner(userData.privateKey);
        return this.walletSdk.createWithdrawProof(assetId, from, value, fee, aztecSigner, to);
    }
    async createTransferProof(assetId, from, to, value, fee) {
        const userData = this.walletSdk.getUserData(from);
        const aztecSigner = this.walletSdk.createSchnorrSigner(userData.privateKey);
        return this.walletSdk.createTransferProof(assetId, from, value, fee, aztecSigner, to);
    }
    async createAccount(accountId, alias, newSigningPublicKey, recoveryPublicKey) {
        return await this.walletSdk.createAccount(accountId, alias, newSigningPublicKey, recoveryPublicKey);
    }
    async signProof(proofOutput, inputOwner, provider) {
        return this.walletSdk.signProof(proofOutput, inputOwner, provider);
    }
    async sendProof(proofOutput, signature) {
        return this.walletSdk.sendProof(proofOutput, signature);
    }
    getUserData(accountId) {
        return this.walletSdk.getUserData(accountId);
    }
    async getAccountId(aliasOrAddress) {
        return this.walletSdk.getAccountId(aliasOrAddress);
    }
    async deriveGrumpkinPrivateKey(address) {
        return (await this.ethSigner.signMessage(Buffer.from('Link Aztec account.'), address)).slice(0, 32);
    }
    async addUser(ethAddress) {
        const privateKey = await this.deriveGrumpkinPrivateKey(ethAddress);
        const user = await this.walletSdk.addUser(privateKey);
        await this.db.setAccount({ ethAddress, accountPublicKey: user.getUserData().publicKey });
        return new ethereum_sdk_user_1.EthereumSdkUser(ethAddress, user.id, this);
    }
    async removeUser(address, accountId) {
        await this.db.deleteAccount(address);
        return this.walletSdk.removeUser(accountId);
    }
    async getUser(address) {
        const pubKey = await this.getPublicKeyFromAddress(address);
        if (!pubKey) {
            return;
        }
        const accountId = await this.walletSdk.getAccountId(pubKey);
        return new ethereum_sdk_user_1.EthereumSdkUser(address, accountId, this);
    }
    getBalance(assetId, accountId) {
        return this.walletSdk.getBalance(assetId, accountId);
    }
    async getMaxSpendableValue(assetId, accountId) {
        return this.walletSdk.getMaxSpendableValue(assetId, accountId);
    }
    async getPublicBalance(assetId, ethAddress) {
        return this.walletSdk.getPublicBalance(assetId, ethAddress);
    }
    async getPublicAllowance(assetId, ethAddress) {
        return this.walletSdk.getPublicAllowance(assetId, ethAddress);
    }
    fromBaseUnits(assetId, value, precision) {
        return this.walletSdk.fromBaseUnits(assetId, value, precision);
    }
    toBaseUnits(assetId, value) {
        return this.walletSdk.toBaseUnits(assetId, value);
    }
    getAssetInfo(assetId) {
        return this.walletSdk.getAssetInfo(assetId);
    }
    async getJoinSplitTxs(accountId) {
        return this.walletSdk.getJoinSplitTxs(accountId);
    }
    async getAccountTxs(accountId) {
        return this.walletSdk.getAccountTxs(accountId);
    }
    async getDefiTxs(accountId) {
        return this.walletSdk.getDefiTxs(accountId);
    }
    async getNotes(accountId) {
        return this.walletSdk.getNotes(accountId);
    }
}
exports.EthereumSdk = EthereumSdk;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXRoZXJldW1fc2RrL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFHQSx5RUFBcUU7QUFDckUseURBQWtFO0FBRWxFLGtEQUEyRjtBQUMzRix3REFBd0Q7QUFDeEQsMERBQWdDO0FBQ2hDLHNFQUFpQztBQUNqQyxtQ0FBc0M7QUFDdEMscUNBQTJDO0FBQzNDLHVEQUErRDtBQUUvRCxnQ0FBa0M7QUFFbEMsOENBQTBDO0FBQzFDLHlDQUFnRjtBQUNoRiwyREFBc0Q7QUFFdEQsOERBQW9DO0FBQ3BDLG9FQUEwQztBQUUxQyxNQUFNLEtBQUssR0FBRyxlQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUU3QyxLQUFLLFVBQVUsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNO0lBQ2xDLElBQUkscUJBQU0sRUFBRTtRQUNWLE1BQU0sTUFBTSxHQUFHLHVCQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEMsTUFBTSxVQUFVLEdBQUcsTUFBTSwwQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNsRCxPQUFPLElBQUksc0JBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztLQUNwQztTQUFNO1FBQ0wsT0FBTyxJQUFJLHdCQUFhLEVBQUUsQ0FBQztLQUM1QjtBQUNILENBQUM7QUFFTSxLQUFLLFVBQVUsWUFBWSxDQUFDLGdCQUFrQyxFQUFFLFNBQWlCLEVBQUUsYUFBeUIsRUFBRTs7SUFDbkgsTUFBTSxFQUFFLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxPQUFPLEVBQUUsR0FBRyxNQUFNLDZCQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRXhGLE1BQU0sSUFBSSxHQUFHLE1BQU0sc0JBQVMsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFcEQsTUFBTSxFQUFFLEdBQUcsTUFBTSxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzFDLE1B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