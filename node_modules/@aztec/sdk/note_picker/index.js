"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotePicker = void 0;
const sorted_notes_1 = require("./sorted_notes");
const pick_1 = require("./pick");
const noteSum = (notes) => notes.reduce((sum, { value }) => sum + value, BigInt(0));
class NotePicker {
    constructor(notes = [], excludeIndices = []) {
        this.notes = notes;
        this.numNotesPerTx = 2;
        const availableNotes = notes.filter(({ index }) => excludeIndices.indexOf(index) < 0);
        this.spendableNotes = new sorted_notes_1.SortedNotes(availableNotes);
    }
    getSpendableNotes(excludeNullifiers) {
        return (excludeNullifiers === null || excludeNullifiers === void 0 ? void 0 : excludeNullifiers.length) ? this.spendableNotes.filter(({ nullifier }) => !excludeNullifiers.some(n => n.equals(nullifier)))
            : this.spendableNotes;
    }
    pick(value, excludeNullifiers) {
        const spendableNotes = this.getSpendableNotes(excludeNullifiers);
        return pick_1.pick(spendableNotes, value);
    }
    getSum() {
        return noteSum(this.notes);
    }
    getSpendableSum(excludeNullifiers) {
        const spendableNotes = this.getSpendableNotes(excludeNullifiers);
        return noteSum(spendableNotes.notes);
    }
    getMaxSpendableValue(excludeNullifiers) {
        const spendableNotes = this.getSpendableNotes(excludeNullifiers);
        const notes = spendableNotes.slice(-this.numNotesPerTx);
        return noteSum(notes);
    }
}
exports.NotePicker = NotePicker;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbm90ZV9waWNrZXIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaURBQTZDO0FBQzdDLGlDQUE4QjtBQUc5QixNQUFNLE9BQU8sR0FBRyxDQUFDLEtBQWEsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRTVGLE1BQWEsVUFBVTtJQUlyQixZQUFvQixRQUFnQixFQUFFLEVBQUUsaUJBQTJCLEVBQUU7UUFBakQsVUFBSyxHQUFMLEtBQUssQ0FBYTtRQUY5QixrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUd4QixNQUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN0RixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksMEJBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBRUQsaUJBQWlCLENBQUMsaUJBQTRCO1FBQzVDLE9BQU8sQ0FBQSxpQkFBaUIsYUFBakIsaUJBQWlCLHVCQUFqQixpQkFBaUIsQ0FBRSxNQUFNLEVBQzlCLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2xHLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzFCLENBQUM7SUFFRCxJQUFJLENBQUMsS0FBYSxFQUFFLGlCQUE0QjtRQUM5QyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNqRSxPQUFPLFdBQUksQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELE1BQU07UUFDSixPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELGVBQWUsQ0FBQyxpQkFBNEI7UUFDMUMsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDakUsT0FBTyxPQUFPLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxvQkFBb0IsQ0FBQyxpQkFBNEI7UUFDL0MsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDakUsTUFBTSxLQUFLLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUN4RCxPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QixDQUFDO0NBQ0Y7QUFsQ0QsZ0NBa0NDIn0=